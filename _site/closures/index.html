<!DOCTYPE html>
<!--[if lt IE 7]><html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]--><!--[if (IE 7)&!(IEMobile)]><html class="no-js lt-ie9 lt-ie8"><![endif]--><!--[if (IE 8)&!(IEMobile)]><html class="no-js lt-ie9"><![endif]--><!--[if gt IE 8]><!--><html class="no-js">
<!--<![endif]--> <head> <meta charset="UTF-8"> <meta content="text/html; charset=UTF-8" http-equiv="Content-Type"> <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"> <title>Blocks, Procs and Lambdas in Ruby – Evolving perceptions</title> <meta name="description" content="A space where I pen down my views and experiences"> <meta name="keywords" content="ruby, closures, blocks, procs, lambdas, Methods"> <!-- Twitter Cards --> <meta name="twitter:card" content="summary"> <meta name="twitter:image" content="http://127.0.0.1:4000/assets/img/logo.jpg"> <meta name="twitter:title" content="Blocks, Procs and Lambdas in Ruby"> <meta name="twitter:description" content="“How are closures implemented in Ruby?”"> <meta name="twitter:site" content="@sailesh_dev"> <meta name="twitter:creator" content="@sailesh_dev"> <!-- Open Graph --> <meta property="og:locale" content="en_US"> <meta property="og:type" content="article"> <meta property="og:title" content="Blocks, Procs and Lambdas in Ruby"> <meta property="og:description" content="“How are closures implemented in Ruby?”"> <meta property="og:url" content="http://127.0.0.1:4000/closures/"> <meta property="og:site_name" content="Evolving perceptions"> <meta property="og:image" content="http://127.0.0.1:4000/assets/img/logo.jpg"> <link rel="canonical" href="http://127.0.0.1:4000/closures/"> <link href="http://127.0.0.1:4000/feed.xml" type="application/atom+xml" rel="alternate" title="Evolving perceptions Feed"> <!-- Handheld --> <meta name="HandheldFriendly" content="True"> <meta name="MobileOptimized" content="320"> <meta name="viewport" content="width=device-width, initial-scale=1.0"> <!-- CSS --> <link rel="stylesheet" href="http://127.0.0.1:4000/assets/css/main.css"> <!-- JS --> <script src="http://127.0.0.1:4000/assets/js/modernizr-3.3.1.custom.min.js"></script> <!-- Favicons --> <link rel="apple-touch-icon" href="http://127.0.0.1:4000/assets/img/favicons/apple-icon-precomposed.png"> <link rel="apple-touch-icon" sizes="72x72" href="http://127.0.0.1:4000/assets/img/favicons/apple-icon-72x72.png"> <link rel="apple-touch-icon" sizes="114x114" href="http://127.0.0.1:4000/assets/img/favicons/apple-icon-114x114.png"> <link rel="apple-touch-icon" sizes="144x144" href="http://127.0.0.1:4000/assets/img/favicons/apple-icon-144x144.png"> <link rel="shortcut icon" type="image/png" href="http://127.0.0.1:4000/favicon.png"> <link rel="shortcut icon" href="http://127.0.0.1:4000/favicon.ico"> <!-- Background Image --> <style type="text/css">body {background-image:url(http://127.0.0.1:4000/assets/img/placeholder-big.jpg); background-repeat: no-repeat; background-size: cover; }</style> <!-- Post Feature Image --> </head> <body> <nav id="dl-menu" class="dl-menuwrapper" role="navigation"> <button class="dl-trigger">Open Menu</button> <ul class="dl-menu"> <li><a href="http://127.0.0.1:4000/">Home</a></li> <li> <a href="#">About</a> <ul class="dl-submenu"> <li> <img src="http://127.0.0.1:4000/assets/img/logo.jpg" alt="Evolving perceptions photo" class="author-photo"> <h4>Evolving perceptions</h4> <p>A space where I pen down my views and experiences</p> </li> <li><a href="http://127.0.0.1:4000/about/"><span class="btn btn-inverse">Learn More</span></a></li> <li> <a href="http://twitter.com/sailesh_dev" target="_blank" rel="noopener noreferrer"><i class="fa fa-fw fa-twitter-square"></i> Twitter</a> </li> <li> <a href="http://linkedin.com/in/sailesh-dev-2822b77b" target="_blank" rel="noopener noreferrer"><i class="fa fa-fw fa-linkedin-square"></i> LinkedIn</a> </li> <li> <a href="http://github.com/saileshdev" target="_blank" rel="noopener noreferrer"><i class="fa fa-fw fa-github"></i> Github</a> </li> </ul>
<!-- /.dl-submenu --> </li> <li> <a href="#">Posts</a> <ul class="dl-submenu"> <li><a href="http://127.0.0.1:4000/posts/">All Posts</a></li> <li><a href="http://127.0.0.1:4000/tags/">All Tags</a></li> </ul> </li> <li><a href="http://127.0.0.1:4000/projects/">Projects</a></li> </ul>
<!-- /.dl-menu --> </nav><!-- /.dl-menuwrapper --> <!-- Header --> <header class="header" role="banner"> <div class="wrapper animated fadeIn"> <div class="content"> <div class="post-title "> <h1>Blocks, Procs and Lambdas in Ruby</h1> <h4>18 Feb 2016</h4> <p class="reading-time"> <i class="fa fa-clock-o"></i> Reading time ~5 minutes </p>
<!-- /.entry-reading-time --> <a class="btn zoombtn" href="http://127.0.0.1:4000/posts/"> <i class="fa fa-chevron-left"></i> </a> </div> <h2 id="blocks">Blocks</h2> <p>Blocks are chunks of code that can be passed around. We can’t find blocks just hanging around without some method. It doesn’t mean anything on a standalone basis and can only appear in argument lists.</p> <p>You declare a block using braces {} if it’s on one line or do … end if it’s on multiple lines. This is just a convention followed in the Ruby community.</p> <p><code class="highlighter-rouge">['s','a','i'].each { |chr| print "#{chr}" }</code></p> <h3 id="blocks-with-input">Blocks with input</h3> <p>Blocks can take inputs and can also return expressions. Blocks lets use the implicit return (whatever’s on the last line) and not the <code class="highlighter-rouge">return</code> keyword, since that will return us from whatever method actually called the block.</p> <h3 id="blocks-are-just-arguments">Blocks are just arguments</h3> <p>Blocks are used as arguments to other methods. They are nothing special, just plain arguments. They are listed last and on their own because they tend to take up multiple lines. Don’t think of them as anything too special.</p> <h3 id="yield">yield</h3> <p><code class="highlighter-rouge">yield</code> basically says “run the block right here”. yield can pass parameters to your block as well.</p> <h3 id="each-method">each method</h3> <p>Lets write the Ruby code for the <code class="highlighter-rouge">each</code> method on Arrays to get an idea of what’s happening behind the scenes.</p> <div class="language-ruby highlighter-rouge"><pre class="highlight"><code><span class="k">class</span> <span class="nc">Array</span> 
  <span class="k">def</span> <span class="nf">each</span>
    <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">while</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="nb">self</span><span class="p">.</span><span class="nf">size</span>
        <span class="k">yield</span><span class="p">(</span><span class="nb">self</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>  
        <span class="n">i</span><span class="o">+=</span><span class="mi">1</span>      
    <span class="k">end</span>
    <span class="nb">self</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="p">[</span><span class="s1">'s'</span><span class="p">,</span><span class="s1">'a'</span><span class="p">,</span><span class="s1">'i'</span><span class="p">].</span><span class="nf">each</span> <span class="p">{</span> <span class="o">|</span><span class="n">chr</span><span class="o">|</span> <span class="nb">print</span> <span class="s2">"</span><span class="si">#{</span><span class="n">chr</span><span class="si">}</span><span class="s2">!"</span> <span class="p">}</span>
</code></pre></div> <h3 id="check-if-block-was-passed">Check if block was passed?</h3> <p>To check if block was passed at all(to only yield in that case): <code class="highlighter-rouge">yield if block_given?</code></p> <h3 id="passing-multiple-blocks">Passing multiple blocks</h3> <p>Can we pass multiple blocks to a function? Can we save a block and use it again later? Thats where the incredible procs(Procedures) comes into picture. Actually, a block is a Proc. The block can be imagined as a subclass of a Proc.</p> <hr> <h2 id="procs">Procs</h2> <p>A Proc can be saved to a variable and reused again unlike blocks.</p> <div class="language-ruby highlighter-rouge"><pre class="highlight"><code><span class="nb">p</span> <span class="o">=</span> <span class="no">Proc</span><span class="p">.</span><span class="nf">new</span> <span class="p">{</span> <span class="o">|</span><span class="n">x</span><span class="o">|</span> <span class="nb">puts</span> <span class="n">x</span> <span class="p">}</span>
<span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">].</span><span class="nf">each</span><span class="p">(</span><span class="o">&amp;</span><span class="nb">p</span><span class="p">)</span>              
<span class="c1"># The '&amp;' tells ruby to turn the proc into a block </span>
</code></pre></div> <h3 id="call">Call</h3> <p>We use <code class="highlighter-rouge">call</code> for Procs instead of <code class="highlighter-rouge">yield</code>. This is quiet intuitive as we know that a function can accept multiple procs unlike a single block so <code class="highlighter-rouge">yield</code> in this case doesn’t mention which Proc has to be called. <code class="highlighter-rouge">call</code> literally just runs the Proc that is called on. It can take arguments as well.</p> <p><code class="highlighter-rouge">p.call(“sailesh”)</code></p> <hr> <h2 id="differences-between-blocks-and-procs">Differences between Blocks and Procs</h2> <p>Procs are objects, blocks are not. A proc is an instance of the Proc class. They can be assigned to variables. Procs can also return themselves.</p> <div class="language-ruby highlighter-rouge"><pre class="highlight"><code><span class="nb">p</span> <span class="o">=</span> <span class="no">Proc</span><span class="p">.</span><span class="nf">new</span> <span class="p">{</span> <span class="nb">puts</span> <span class="s2">"Welcome!"</span> <span class="p">}</span>

<span class="nb">p</span><span class="p">.</span><span class="nf">call</span>  <span class="c1"># prints 'Welcome'</span>
<span class="nb">p</span><span class="p">.</span><span class="nf">class</span> <span class="c1"># returns 'Proc'</span>
<span class="n">a</span> <span class="o">=</span> <span class="nb">p</span>   <span class="c1"># a now equals p, a Proc instance</span>
<span class="nb">p</span>       <span class="c1"># returns a proc object id</span>
</code></pre></div> <p>In contrast, a block is just part of the syntax of a method call.</p> <div class="language-ruby highlighter-rouge"><pre class="highlight"><code><span class="p">{</span> <span class="nb">puts</span> <span class="s2">"Welcome!"</span><span class="p">}</span>       <span class="c1"># syntax error  </span>
<span class="n">a</span> <span class="o">=</span> <span class="p">{</span> <span class="nb">puts</span> <span class="s2">"Welcome!"</span><span class="p">}</span>   <span class="c1"># syntax error</span>
<span class="p">[</span><span class="s1">'s'</span><span class="p">,</span><span class="s1">'a'</span><span class="p">,</span><span class="s1">'i'</span><span class="p">].</span><span class="nf">each</span> <span class="p">{</span> <span class="o">|</span><span class="n">chr</span><span class="o">|</span> <span class="nb">print</span> <span class="s2">"</span><span class="si">#{</span><span class="n">chr</span><span class="si">}</span><span class="s2">!"</span> <span class="p">}</span> <span class="c1"># no error</span>
</code></pre></div> <p>We can pass multiple procs to methods.</p> <div class="language-ruby highlighter-rouge"><pre class="highlight"><code><span class="k">def</span> <span class="nf">funct</span><span class="p">(</span><span class="n">proc1</span><span class="p">,</span> <span class="n">proc2</span><span class="p">)</span>
  <span class="n">proc1</span><span class="p">.</span><span class="nf">call</span>
  <span class="n">proc2</span><span class="p">.</span><span class="nf">call</span>
<span class="k">end</span>

<span class="n">p1</span> <span class="o">=</span> <span class="no">Proc</span><span class="p">.</span><span class="nf">new</span> <span class="p">{</span> <span class="nb">puts</span> <span class="s2">"proc 1"</span> <span class="p">}</span>
<span class="n">p2</span> <span class="o">=</span> <span class="no">Proc</span><span class="p">.</span><span class="nf">new</span> <span class="p">{</span> <span class="nb">puts</span> <span class="s2">"proc 2"</span> <span class="p">}</span>

<span class="n">funct</span><span class="p">(</span><span class="n">p1</span><span class="p">,</span><span class="n">p2</span><span class="p">)</span>
</code></pre></div> <hr> <h2 id="lambdas">Lambdas</h2> <p>A lambda acts more like a real method. A lambda gives us more flexibility with what it returns (like if you want to return multiple values at once) because we can safely use the explicit return statement inside of one. With lambdas, return will only return from the lambda itself and not the enclosing method, which is what happens if you use return inside a block or Proc. Lambdas are also much stricter than Procs about passing them the correct number of arguments.</p> <div class="language-ruby highlighter-rouge"><pre class="highlight"><code><span class="nb">lambda</span> <span class="k">do</span> <span class="o">|</span><span class="n">arg</span><span class="o">|</span> 
	<span class="nb">puts</span> <span class="n">arg</span>
	<span class="k">return</span> <span class="n">arg</span>          <span class="c1"># you can do this in lambdas not Procs</span>
<span class="k">end</span><span class="p">.</span><span class="nf">call</span><span class="p">(</span><span class="s2">"sailesh"</span><span class="p">)</span>
<span class="c1">#we are chaining the call method on the lambda</span>
</code></pre></div> <hr> <h2 id="differences-between-procs-and-lambdas">Differences between Procs and Lambdas</h2> <p>Its important to note that they are both Proc objects.</p> <div class="language-ruby highlighter-rouge"><pre class="highlight"><code><span class="nb">proc</span> <span class="o">=</span> <span class="no">Proc</span><span class="p">.</span><span class="nf">new</span> <span class="p">{</span> <span class="nb">puts</span> <span class="s2">"Welcome!"</span> <span class="p">}</span>
<span class="n">lam</span> <span class="o">=</span> <span class="nb">lambda</span> <span class="p">{</span> <span class="nb">puts</span> <span class="s2">"Welcome!"</span> <span class="p">}</span>

<span class="nb">proc</span><span class="p">.</span><span class="nf">class</span> <span class="c1"># returns 'Proc'</span>
<span class="n">lam</span><span class="p">.</span><span class="nf">class</span>  <span class="c1"># returns 'Proc'</span>
</code></pre></div> <p>Lambdas check the number of arguments, while procs do not</p> <div class="language-ruby highlighter-rouge"><pre class="highlight"><code><span class="n">lam</span> <span class="o">=</span> <span class="nb">lambda</span> <span class="p">{</span> <span class="o">|</span><span class="n">x</span><span class="o">|</span> <span class="nb">puts</span> <span class="n">x</span> <span class="p">}</span>    <span class="c1"># creates a lambda that takes 1 argument</span>
<span class="n">lam</span><span class="p">.</span><span class="nf">call</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>                    <span class="c1"># prints out 5</span>
<span class="n">lam</span><span class="p">.</span><span class="nf">call</span>                       <span class="c1"># ArgumentError: wrong number of arguments (0 for 1)</span>
<span class="n">lam</span><span class="p">.</span><span class="nf">call</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span><span class="mi">8</span><span class="p">,</span><span class="mi">9</span><span class="p">)</span>                <span class="c1"># ArgumentError: wrong number of arguments (3 for 1)</span>
</code></pre></div> <p>Procs don’t care if they are passed the wrong number of arguments.</p> <div class="language-ruby highlighter-rouge"><pre class="highlight"><code><span class="nb">proc</span> <span class="o">=</span> <span class="no">Proc</span><span class="p">.</span><span class="nf">new</span> <span class="p">{</span> <span class="o">|</span><span class="n">x</span><span class="o">|</span> <span class="nb">puts</span> <span class="n">x</span> <span class="p">}</span> <span class="c1"># creates a proc that takes 1 argument</span>
<span class="nb">proc</span><span class="p">.</span><span class="nf">call</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>                   <span class="c1"># prints out 5</span>
<span class="nb">proc</span><span class="p">.</span><span class="nf">call</span>                      <span class="c1"># returns nil</span>
<span class="nb">proc</span><span class="p">.</span><span class="nf">call</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span><span class="mi">8</span><span class="p">,</span><span class="mi">9</span><span class="p">)</span>               <span class="c1"># prints out 7 and forgets about the extra arguments</span>
</code></pre></div> <p><code class="highlighter-rouge">return</code> inside of a lambda triggers the code right outside of the lambda code</p> <hr> <h2 id="closures">Closures</h2> <p>The term closure is often mistakenly used to mean anonymous function. This is probably because many programmers learn about both concepts at the same time, in the form of small helper functions that are anonymous closures. An anonymous function is a function literal without a name, while a closure is an instance of a function, a value, whose non-local variables have been bound either to values or to storage locations.</p> <h3 id="proc-objects-preserving-local-context">Proc objects preserving local context</h3> <div class="language-ruby highlighter-rouge"><pre class="highlight"><code><span class="k">def</span> <span class="nf">counter</span>
  <span class="n">n</span> <span class="o">=</span> <span class="mi">0</span>
  <span class="k">return</span> <span class="no">Proc</span><span class="p">.</span><span class="nf">new</span> <span class="p">{</span> <span class="n">n</span><span class="o">+=</span> <span class="mi">1</span> <span class="p">}</span>
<span class="k">end</span>

<span class="n">a</span> <span class="o">=</span> <span class="n">counter</span>
<span class="n">a</span><span class="p">.</span><span class="nf">call</span>            <span class="c1"># returns 1</span>
<span class="n">a</span><span class="p">.</span><span class="nf">call</span>            <span class="c1"># returns 2</span>

<span class="n">b</span> <span class="o">=</span> <span class="n">counter</span>
<span class="n">b</span><span class="p">.</span><span class="nf">call</span>            <span class="c1"># returns 1</span>

<span class="n">a</span><span class="p">.</span><span class="nf">call</span>            <span class="c1"># returns 3</span>
</code></pre></div> <hr> <h2 id="methods">Methods</h2> <p>This is very different from an actual method. They are a convenient way to pass a normal method to another normal method by wrapping the symbol of its name in the word method()</p> <div class="entry-meta"> <br> <hr> <span class="entry-tags"><a href="http://127.0.0.1:4000/tags/#ruby" title="Pages tagged ruby" class="tag"><span class="term">ruby</span></a><a href="http://127.0.0.1:4000/tags/#closures" title="Pages tagged closures" class="tag"><span class="term">closures</span></a><a href="http://127.0.0.1:4000/tags/#blocks" title="Pages tagged blocks" class="tag"><span class="term">blocks</span></a><a href="http://127.0.0.1:4000/tags/#procs" title="Pages tagged procs" class="tag"><span class="term">procs</span></a><a href="http://127.0.0.1:4000/tags/#lambdas" title="Pages tagged lambdas" class="tag"><span class="term">lambdas</span></a><a href="http://127.0.0.1:4000/tags/#Methods" title="Pages tagged Methods" class="tag"><span class="term">Methods</span></a></span> <span class="social-share"> <a href="https://www.facebook.com/sharer/sharer.php?u=http://127.0.0.1:4000/closures/" title="Share on Facebook" class="tag"> <span class="term"><i class="fa fa-facebook-square"></i> Like</span> </a> <a href="https://twitter.com/intent/tweet?text=http://127.0.0.1:4000/closures/" title="Share on Twitter" class="tag"> <span class="term"><i class="fa fa-twitter-square"></i> Tweet</span> </a> <a href="https://plus.google.com/share?url=http://127.0.0.1:4000/closures/" title="Share on Google+" class="tag"> <span class="term"><i class="fa fa-google-plus-square"></i> +1</span> </a> </span> <div style="clear:both"></div> </div> </div> </div> <section id="disqus_thread" class="animated fadeInUp"></section><!-- /#disqus_thread --> </header> <!-- JS --> <script src="http://127.0.0.1:4000/assets/js/jquery-1.12.0.min.js"></script> <script src="http://127.0.0.1:4000/assets/js/jquery.dlmenu.min.js"></script> <script src="http://127.0.0.1:4000/assets/js/jquery.goup.min.js"></script> <script src="http://127.0.0.1:4000/assets/js/jquery.magnific-popup.min.js"></script> <script src="http://127.0.0.1:4000/assets/js/jquery.fitvid.min.js"></script> <script src="http://127.0.0.1:4000/assets/js/scripts.js"></script> <script type="text/javascript"> var disqus_shortname = 'evolvingperceptionsblog'; (function() { var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true; dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js'; (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq); })(); (function () { var s = document.createElement('script'); s.async = true; s.type = 'text/javascript'; s.src = '//' + disqus_shortname + '.disqus.com/count.js'; (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s); }()); </script> <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a>
</noscript> <!-- MathJax --> <script async src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script> </body> </html>
