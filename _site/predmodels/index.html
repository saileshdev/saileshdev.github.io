<!DOCTYPE html>
<!--[if lt IE 7]><html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]--><!--[if (IE 7)&!(IEMobile)]><html class="no-js lt-ie9 lt-ie8"><![endif]--><!--[if (IE 8)&!(IEMobile)]><html class="no-js lt-ie9"><![endif]--><!--[if gt IE 8]><!--><html class="no-js">
<!--<![endif]--> <head> <meta charset="UTF-8"> <meta content="text/html; charset=UTF-8" http-equiv="Content-Type"> <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"> <title>Predictive Analytics – Evolving perceptions</title> <meta name="description" content="A space where I pen down my views and experiences"> <meta name="keywords" content="mathematical models, predictive models, regression"> <!-- Twitter Cards --> <meta name="twitter:card" content="summary"> <meta name="twitter:image" content="https://saileshdev.github.io/assets/img/logo.jpg"> <meta name="twitter:title" content="Predictive Analytics"> <meta name="twitter:description" content="A brief introduction to predictive models using python"> <meta name="twitter:site" content="@sailesh_dev"> <meta name="twitter:creator" content="@sailesh_dev"> <!-- Open Graph --> <meta property="og:locale" content="en_US"> <meta property="og:type" content="article"> <meta property="og:title" content="Predictive Analytics"> <meta property="og:description" content="A brief introduction to predictive models using python"> <meta property="og:url" content="https://saileshdev.github.io/predmodels/"> <meta property="og:site_name" content="Evolving perceptions"> <meta property="og:image" content="https://saileshdev.github.io/assets/img/logo.jpg"> <link rel="canonical" href="https://saileshdev.github.io/predmodels/"> <link href="https://saileshdev.github.io/feed.xml" type="application/atom+xml" rel="alternate" title="Evolving perceptions Feed"> <!-- Handheld --> <meta name="HandheldFriendly" content="True"> <meta name="MobileOptimized" content="320"> <meta name="viewport" content="width=device-width, initial-scale=1.0"> <!-- CSS --> <link rel="stylesheet" href="https://saileshdev.github.io/assets/css/main.css"> <!-- JS --> <script src="https://saileshdev.github.io/assets/js/modernizr-3.3.1.custom.min.js"></script> <!-- Favicons --> <link rel="apple-touch-icon" href="https://saileshdev.github.io/assets/img/favicons/apple-icon-precomposed.png"> <link rel="apple-touch-icon" sizes="72x72" href="https://saileshdev.github.io/assets/img/favicons/apple-icon-72x72.png"> <link rel="apple-touch-icon" sizes="114x114" href="https://saileshdev.github.io/assets/img/favicons/apple-icon-114x114.png"> <link rel="apple-touch-icon" sizes="144x144" href="https://saileshdev.github.io/assets/img/favicons/apple-icon-144x144.png"> <link rel="shortcut icon" type="image/png" href="https://saileshdev.github.io/favicon.png"> <link rel="shortcut icon" href="https://saileshdev.github.io/favicon.ico"> <!-- Background Image --> <style type="text/css">body {background-image:url(https://saileshdev.github.io/assets/img/placeholder-big.jpg); background-repeat: no-repeat; background-size: cover; }</style> <!-- Post Feature Image --> </head> <body> <nav id="dl-menu" class="dl-menuwrapper" role="navigation"> <button class="dl-trigger">Open Menu</button> <ul class="dl-menu"> <li><a href="https://saileshdev.github.io/">Home</a></li> <li> <a href="#">About</a> <ul class="dl-submenu"> <li> <img src="https://saileshdev.github.io/assets/img/logo.jpg" alt="Evolving perceptions photo" class="author-photo"> <h4>Evolving perceptions</h4> <p>A space where I pen down my views and experiences</p> </li> <li><a href="https://saileshdev.github.io/about/"><span class="btn btn-inverse">Learn More</span></a></li> <li> <a href="http://twitter.com/sailesh_dev" target="_blank" rel="noopener noreferrer"><i class="fa fa-fw fa-twitter-square"></i> Twitter</a> </li> <li> <a href="http://linkedin.com/in/sailesh-dev-2822b77b" target="_blank" rel="noopener noreferrer"><i class="fa fa-fw fa-linkedin-square"></i> LinkedIn</a> </li> <li> <a href="http://github.com/saileshdev" target="_blank" rel="noopener noreferrer"><i class="fa fa-fw fa-github"></i> Github</a> </li> </ul>
<!-- /.dl-submenu --> </li> <li> <a href="#">Posts</a> <ul class="dl-submenu"> <li><a href="https://saileshdev.github.io/posts/">All Posts</a></li> <li><a href="https://saileshdev.github.io/tags/">All Tags</a></li> </ul> </li> <li><a href="https://saileshdev.github.io/projects/">Projects</a></li> </ul>
<!-- /.dl-menu --> </nav><!-- /.dl-menuwrapper --> <!-- Header --> <header class="header" role="banner"> <div class="wrapper animated fadeIn"> <div class="content"> <div class="post-title "> <h1>Predictive Analytics</h1> <h4>18 Mar 2016</h4> <p class="reading-time"> <i class="fa fa-clock-o"></i> Reading time ~6 minutes </p>
<!-- /.entry-reading-time --> <a class="btn zoombtn" href="https://saileshdev.github.io/posts/"> <i class="fa fa-chevron-left"></i> </a> </div> <p>The goal of developing a predictive model is to develop a model that is accurate on unseen data. This can be achieved using statistical techniques where the training dataset is carefully used to estimate the performance of the model on new and unseen data.</p> <h2 id="regression-analysis">Regression analysis:</h2> <p>Try to fit a function to a set given values and predict values we haven seen yet</p> <h2 id="linear-regression">Linear regression:</h2> <ul> <li>Fitting a straight line to a set of observations</li> <li>And use this line to predict unobserved values</li> </ul> <p>This is the same as maximizing the likelihood of the observed data in terms of probabilities. Sometimes called “maximum likelihood estimation”</p> <h3 id="how-does-it-work">How does it work?</h3> <p>We have 2 methods:</p> <h3 id="ordinary-least-squaresols">Ordinary least squares(OLS):</h3> <p>Minimizes the squared error between each point and the line(least squares)</p> <h3 id="gradient-descent">Gradient Descent:</h3> <p>Gradient descent is an alternative method(can make sense when dealing with 3D data)</p> <h3 id="how-good-is-my-regression">How good is my regression?</h3> <p>How good is my fitting line? It is determined by R-squared(also called coefficient of determination). It is the fraction of the total variantion in Y, that is captured by the model.</p> <p>R-squared = (1.0 - Sum of squared errors)/ Sum of squared variance from mean</p> <p>It ranges from 0 to 1:</p> <ul> <li>0 is bad(none of the variances is captured)</li> <li>1 is good(all the variances on both sides of the fitting line is captured)</li> </ul> <p>We have many models like linear regression. R-squared is a quantitative measure of the suitability of the model. Depending on its value we can choose the model that suits the problem best.</p> <hr> <h2 id="linear-regression-with-python">Linear regression with python:</h2> <p>So lets create 2 variables which have a linear relationship and lets work on those datasets.</p> <div class="language-python highlighter-rouge"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">pylab</span> <span class="kn">import</span> <span class="o">*</span>

<span class="n">pageSpeeds</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="mf">3.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mi">1000</span><span class="p">)</span>
<span class="n">purchaseAmount</span> <span class="o">=</span> <span class="mi">100</span> <span class="o">-</span> <span class="p">(</span><span class="n">pageSpeeds</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mi">1000</span><span class="p">))</span> <span class="o">*</span> <span class="mi">3</span>
<span class="c">#so we are creatng 2 vars which linearly depend on each other</span>
<span class="n">scatter</span><span class="p">(</span><span class="n">pageSpeeds</span><span class="p">,</span> <span class="n">purchaseAmount</span><span class="p">)</span>
</code></pre></div> <p>Now lets use the scipy package to find the linear line and r-squared value of the linear regression model.</p> <div class="language-python highlighter-rouge"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">scipy</span> <span class="kn">import</span> <span class="n">stats</span>
<span class="n">slope</span><span class="p">,</span> <span class="n">intercept</span><span class="p">,</span> <span class="n">r_value</span><span class="p">,</span> <span class="n">p_value</span><span class="p">,</span> <span class="n">std_err</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">linregress</span><span class="p">(</span><span class="n">pageSpeeds</span><span class="p">,</span> <span class="n">purchaseAmount</span><span class="p">)</span>
<span class="c"># so essentially tuple unpacking happens here</span>
<span class="c"># slope and intercept are the parameters of the line that fits the model</span>
<span class="c"># r_value**2 will talk about the quality of this linear model we are trying to fit</span>
</code></pre></div> <p>Now lets use the slope and intercept to plot the linear model along side the original data</p> <div class="language-python highlighter-rouge"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="kn">as</span> <span class="nn">plt</span>

<span class="k">def</span> <span class="nf">predict</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">slope</span> <span class="o">*</span> <span class="n">x</span> <span class="o">+</span> <span class="n">intercept</span>

    <span class="n">fitLine</span> <span class="o">=</span> <span class="n">predict</span><span class="p">(</span><span class="n">pageSpeeds</span><span class="p">)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">pageSpeeds</span><span class="p">,</span> <span class="n">purchaseAmount</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">pageSpeeds</span><span class="p">,</span> <span class="n">fitLine</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s">'r'</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</code></pre></div> <p>So if the r-squared value is close to 1, then it means that the model is suitable and hence we can use the line equation to predict new values. Here in this case r value will be close to 1(as we created the data sets to be linearly dependent). Hence, we can use the above predict() function to predict new values as this model is a good fit.</p> <hr> <h2 id="polynomial-regression">Polynomial regression:</h2> <ul> <li>Why limit to straight lines, may be we cant capture our data in a straight line and there is a curve to it</li> <li>Not all relationships are linear</li> <li>If we do polynomial regression for degree 2 we get a,b,c values of ax^2+bx+c</li> <li>Similarly for polynomial regression for degree 3 we get a,b,c,d and so on</li> </ul> <h2 id="beware-overfitting">Beware overfitting:</h2> <ol> <li>Dont use more degrees than you need</li> <li>Vizualize your fit</li> <li>A higher r-squared simply means your curve fits your training data well, but it may not be a good predictor</li> </ol> <hr> <h2 id="polynomial-regression-using-python">Polynomial regression using python:</h2> <p>What if your data doesnt look linear at all? Lets look at some more realistic-looking page speed / purchase data:</p> <div class="language-python highlighter-rouge"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">pylab</span> <span class="kn">import</span> <span class="o">*</span>

<span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="c">#allows us to generate the same random values over and over again</span>
<span class="n">pageSpeeds</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="mf">3.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mi">1000</span><span class="p">)</span>
<span class="n">purchaseAmount</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="mf">50.0</span><span class="p">,</span> <span class="mf">10.0</span><span class="p">,</span> <span class="mi">1000</span><span class="p">)</span> <span class="o">/</span> <span class="n">pageSpeeds</span>

<span class="n">scatter</span><span class="p">(</span><span class="n">pageSpeeds</span><span class="p">,</span> <span class="n">purchaseAmount</span><span class="p">)</span>
</code></pre></div> <p>numpy has a handy polyfit function we can use, to let us construct an nth-degree polynomial model of our data that minimizes squared error. Lets try it with a 4th degree polynomial:</p> <div class="language-python highlighter-rouge"><pre class="highlight"><code><span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">pageSpeeds</span><span class="p">)</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">purchaseAmount</span><span class="p">)</span>

<span class="n">p4</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">poly1d</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">polyfit</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span> <span class="c">#so np.polyfit does the job and 4 means we need python to perform 4th degree polynomial regression</span>
<span class="c"># np.polyfit returns the coefficients as np.ndarray </span>
<span class="c"># np.ploy1d constructs the polynomial with those coeffiecients, so now p4(2) gives the value of the poly at 4</span>
</code></pre></div> <p>We will visualize our original scatter plot, together with a plot of our predicted values using the polynomial for page speed times ranging from 0-7 seconds:</p> <div class="language-python highlighter-rouge"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="kn">as</span> <span class="nn">plt</span>

<span class="n">xp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
<span class="c"># means start is 0 and end is 7 and we need 100 equi-spaced points</span>
<span class="c"># in np.arange we specify start,stop and step(not no of points) unlike np.linspace</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xp</span><span class="p">,</span> <span class="n">p4</span><span class="p">(</span><span class="n">xp</span><span class="p">),</span> <span class="n">c</span><span class="o">=</span><span class="s">'r'</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</code></pre></div> <p>Lets measure the r-squared error:</p> <div class="language-python highlighter-rouge"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">r2_score</span>

<span class="n">r2</span> <span class="o">=</span> <span class="n">r2_score</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">p4</span><span class="p">(</span><span class="n">x</span><span class="p">))</span> <span class="o">//</span><span class="n">r2_score</span> <span class="ow">is</span> <span class="n">a</span> <span class="n">func</span> <span class="ow">in</span> <span class="n">sklearn</span><span class="o">.</span><span class="n">metrics</span>
<span class="k">print</span> <span class="n">r2</span>
</code></pre></div> <hr> <h2 id="multivariate-regression">Multivariate Regression</h2> <p>What happens if we are predecting a value and it is based on more than one attribute? Ex: height depends not only on weight but also on genetics</p> <p>Thats where Multivariate Regression analysis comes into place</p> <p>Multivariate Regression(More than one factor influences): Ex: Predicting the price for a car depends on body style, mileage, brand,etc and should take into account all the factors</p> <h3 id="how-it-works">How it works?</h3> <ul> <li>Still uses the least squares</li> <li>We end up with coeffients for each factor</li> <li>These coefficients imply how important each factor is(if the data is all normalized). These coefficients inply how important each factor is.</li> <li>Need to assume the different factors are not themselves dependent on each other.</li> <li>Get rid of ones that dont matter!</li> <li>Can still measure fit with r-squared</li> </ul> <h2 id="multivariate-regression-using-python">Multivariate regression using python:</h2> <p>Lets find the effect of mileage, model and no of doors on a car price.</p> <p>We can use pandas to split up this matrix into the feature vectors we are interested in, and the value we are trying to predict. Note how we use pandas.Categorical to convert textual category data (model name) into an ordinal number that we can work with.</p> <div class="language-python highlighter-rouge"><pre class="highlight"><code><span class="c"># lets us deal with tabular data easier</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="kn">as</span> <span class="nn">pd</span>

<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_excel</span><span class="p">(</span><span class="s">'path_can_be_even_from_web'</span><span class="p">)</span>
<span class="c"># df is a dataFrame obj</span>
<span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>

<span class="kn">import</span> <span class="nn">statsmodels.api</span> <span class="kn">as</span> <span class="nn">sm</span>

<span class="n">df</span><span class="p">[</span><span class="s">'Model_ord'</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Categorical</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span><span class="o">.</span><span class="n">codes</span> <span class="c"># we are converting the model column to number so that we can work with it</span>
<span class="c"># df.Model is same as df['Model'] which is a Series obj</span>
<span class="c"># pd.Categorical(df.Model).codes returns an np.ndarray back</span>
<span class="n">X</span> <span class="o">=</span> <span class="n">df</span><span class="p">[[</span><span class="s">'Mileage'</span><span class="p">,</span> <span class="s">'Model_ord'</span><span class="p">,</span> <span class="s">'Doors'</span><span class="p">]]</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">df</span><span class="p">[[</span><span class="s">'Price'</span><span class="p">]]</span>
<span class="c"># X, y are dataFrame objs</span>

<span class="n">X1</span> <span class="o">=</span> <span class="n">sm</span><span class="o">.</span><span class="n">add_constant</span><span class="p">(</span><span class="n">X</span><span class="p">)</span> 
<span class="c">#the model needs an extra column for intercept, so we are craeting a new column named constant and filling all values with 1</span>
<span class="n">est</span> <span class="o">=</span> <span class="n">sm</span><span class="o">.</span><span class="n">OLS</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">X1</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>

<span class="n">est</span><span class="o">.</span><span class="n">summary</span><span class="p">()</span>
<span class="c">#this actually returns a Summary obj</span>
</code></pre></div> <p>We get a table back which summarizes the fitting. The table of coefficients gives us the values to plug into an equation of form: <code class="highlighter-rouge">B0 + B1 * Mileage + B2 * model_ord + B3 * doors</code></p> <p>But in this example, its pretty clear that mileage is more important than anything based on the std errs in the table.</p> <hr> <h2 id="multi-level-models">Multi-level models:</h2> <p>The concept is that some effects happens at various levels. Multi-level models attempts to model and account for these interdepencies.</p> <p>Ex: health,wealth Identify the factors that affect the outcome we are trying to predict at each level</p> <div class="entry-meta"> <br> <hr> <span class="entry-tags"><a href="https://saileshdev.github.io/tags/#mathematical%20models" title="Pages tagged mathematical models" class="tag"><span class="term">mathematical models</span></a><a href="https://saileshdev.github.io/tags/#predictive%20models" title="Pages tagged predictive models" class="tag"><span class="term">predictive models</span></a><a href="https://saileshdev.github.io/tags/#regression" title="Pages tagged regression" class="tag"><span class="term">regression</span></a></span> <span class="social-share"> <a href="https://www.facebook.com/sharer/sharer.php?u=https://saileshdev.github.io/predmodels/" title="Share on Facebook" class="tag"> <span class="term"><i class="fa fa-facebook-square"></i> Like</span> </a> <a href="https://twitter.com/intent/tweet?text=https://saileshdev.github.io/predmodels/" title="Share on Twitter" class="tag"> <span class="term"><i class="fa fa-twitter-square"></i> Tweet</span> </a> <a href="https://plus.google.com/share?url=https://saileshdev.github.io/predmodels/" title="Share on Google+" class="tag"> <span class="term"><i class="fa fa-google-plus-square"></i> +1</span> </a> </span> <div style="clear:both"></div> </div> </div> </div> <section id="disqus_thread" class="animated fadeInUp"></section><!-- /#disqus_thread --> </header> <!-- JS --> <script src="https://saileshdev.github.io/assets/js/jquery-1.12.0.min.js"></script> <script src="https://saileshdev.github.io/assets/js/jquery.dlmenu.min.js"></script> <script src="https://saileshdev.github.io/assets/js/jquery.goup.min.js"></script> <script src="https://saileshdev.github.io/assets/js/jquery.magnific-popup.min.js"></script> <script src="https://saileshdev.github.io/assets/js/jquery.fitvid.min.js"></script> <script src="https://saileshdev.github.io/assets/js/scripts.js"></script> <script type="text/javascript"> var disqus_shortname = 'evolvingperceptionsblog'; (function() { var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true; dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js'; (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq); })(); (function () { var s = document.createElement('script'); s.async = true; s.type = 'text/javascript'; s.src = '//' + disqus_shortname + '.disqus.com/count.js'; (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s); }()); </script> <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a>
</noscript> <!-- MathJax --> <script async src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script> </body> </html>
